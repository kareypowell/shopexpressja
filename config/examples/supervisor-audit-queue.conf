# Supervisor Configuration for ShipSharkLtd Audit Queue Workers
# Place this file in /etc/supervisor/conf.d/ on your server
# 
# Installation:
# 1. Copy this file to /etc/supervisor/conf.d/audit-queue-worker.conf
# 2. Update the paths to match your application directory
# 3. Run: supervisorctl reread && supervisorctl update
# 4. Start workers: supervisorctl start audit-queue-worker:*

[program:audit-queue-worker]
# Process name pattern - allows multiple workers
process_name=%(program_name)s_%(process_num)02d

# Command to run - update path to your Laravel application
command=php /var/www/shipsharkltd/artisan queue:work --queue=audit-processing --tries=3 --timeout=60 --memory=512

# Auto-start and restart settings
autostart=true
autorestart=true

# User to run the process as (should match your web server user)
user=www-data

# Number of worker processes to run
numprocs=2

# Logging configuration
redirect_stderr=true
stdout_logfile=/var/www/shipsharkltd/storage/logs/audit-queue-worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

# Process management
stopwaitsecs=3600
killasgroup=true

# Environment variables (optional)
environment=LARAVEL_ENV="production"

# =============================================================================
# HIGH VOLUME CONFIGURATION
# =============================================================================
# For high-volume environments, use this configuration instead:

# [program:audit-queue-worker-high-volume]
# process_name=%(program_name)s_%(process_num)02d
# command=php /var/www/shipsharkltd/artisan queue:work --queue=audit-processing --tries=3 --timeout=120 --memory=1024 --sleep=1
# autostart=true
# autorestart=true
# user=www-data
# numprocs=4
# redirect_stderr=true
# stdout_logfile=/var/www/shipsharkltd/storage/logs/audit-queue-worker.log
# stdout_logfile_maxbytes=50MB
# stdout_logfile_backups=10
# stopwaitsecs=3600
# killasgroup=true

# =============================================================================
# DEVELOPMENT CONFIGURATION
# =============================================================================
# For development environments, use this configuration:

# [program:audit-queue-worker-dev]
# process_name=%(program_name)s_%(process_num)02d
# command=php /var/www/shipsharkltd/artisan queue:work --queue=audit-processing --tries=1 --timeout=30 --memory=256
# autostart=false
# autorestart=true
# user=www-data
# numprocs=1
# redirect_stderr=true
# stdout_logfile=/var/www/shipsharkltd/storage/logs/audit-queue-worker-dev.log
# stopwaitsecs=60

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================
# Additional supervisor program for monitoring audit queue health

# [program:audit-queue-monitor]
# command=php /var/www/shipsharkltd/artisan audit:queue-monitor
# autostart=true
# autorestart=true
# user=www-data
# redirect_stderr=true
# stdout_logfile=/var/www/shipsharkltd/storage/logs/audit-queue-monitor.log
# stopwaitsecs=60